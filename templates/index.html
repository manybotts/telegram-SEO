<script>
        $(document).ready(function() {
            $('#analysis-form').on('submit', function(e) {
                e.preventDefault();

                const keyword = $('#keyword').val();
                $('#results-container').show(); // Show results container
                $('#error-message').hide();
                $('#loading-indicator').show(); // Show loading indicator

                // Clear previous results
                $('#google-trends-list').empty();
                $('#x-trends-list').empty();
                $('#youtube-trends-list').empty();
                $('#telegram-channels-table tbody').empty();


                $.ajax({
                    url: '/analyze',
                    method: 'POST',
                    data: { keyword: keyword },
                    dataType: 'json',
                    success: function(data) { // Corrected:  Call the function with the data
                        $('#loading-indicator').hide();

                        // --- Trends ---
                        function populateTrendList(listId, trends) {
                            const $list = $(listId);
                            if (trends && trends.length > 0) {
                                trends.forEach(trend => {
                                    $list.append(`<li class="list-group-item">${trend}</li>`);
                                });
                            } else {
                                $list.append('<li class="list-group-item">No trends found.</li>');
                            }
                        }
                        populateTrendList('#google-trends-list', data.google_trends);
                        populateTrendList('#x-trends-list', data.x_trends);
                        populateTrendList('#youtube-trends-list', data.youtube_trends);

                        // --- Telegram Channels ---
                       if (data.telegram_channels && data.telegram_channels.length > 0) {
                            data.telegram_channels.forEach(channel => {
                                $('#telegram-channels-table tbody').append(`
                                    <tr>
                                        <td>${channel.rank}</td>
                                        <td><a href="https://t.me/${channel.username}" target="_blank">@${channel.username}</a></td>
                                        <td>${channel.name}</td>
                                        <td>${channel.subscribers}</td>
                                        <td>${channel.description ? channel.description : ''}</td>
                                    </tr>
                                `);
                            });
                        } else {
                            $('#telegram-channels-table tbody').append('<tr><td colspan="5">No relevant channels found.</td></tr>');
                        }

                        // --- Metadata ---
                        $('#suggested-name').text(data.metadata.name);
                        $('#suggested-username').text(data.metadata.username);
                        $('#suggested-description').text(data.metadata.description);
                    },
                    error: function(xhr, status, error) { // Corrected: Call the function with the error parameters
                        $('#loading-indicator').hide();
                        $('#error-message').text('An error occurred: ' + error).show();
                    }
                });
            });
        });
    </script>
